<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"/>
	<title>Live Now</title>
	<link rel="shortcut icon" href="favicon.ico">
	<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
	<script type="text/javascript" src="tinycon.min.js"></script>
	<script type="text/javascript" src="livenow.js"></script>
	<script type="text/javascript" src="client.js"></script>
	<style>
		body {
			margin: 10px;
			background: #111;
			color: #AAA;
			font-family: sans-serif;
		}
		
		a {
			color: #AAF;
		}
		
		div.tab {
			display: inline-block;
			padding: 5px;
			border-radius: 7px;
			border-bottom-left-radius: 0;
			border-bottom-right-radius: 0;
			background: #222;
			color: #888;
			font-size: 80%;
			font-weight: bold;
			z-index: 100;
		}
		
		div.beta {
			position: fixed;
			bottom: 0;
		}
		
		.fade {
			opacity: 0.3;
		}
		
		#boktai {
			display: inline-block;
			cursor: pointer;
			width: 28px;
			height: 24px;
			background: url('img/boktai.png');
			background-size: cover;
			background-position: 28px;
			vertical-align: top;
			border-top-right-radius: 7px;
		}
	</style>
</head>
<body>
<img src="img/mark.png" style="position: fixed; right: 10px; bottom: 0; z-index: -9999;">
<div id="main">
	<div style="float: left; width: 300px; margin-right: 10px; margin-bottom: 1em;">
		<a href="http://www.therockmanexezone.com/"><img src="img/logo.png" width="300"></a>
		<h1 style="margin: 0;">Live Now 2.3 <em style="font-style: italic; font-size: 50%; display: inline;">Beta</em></h1>
		<p style="margin: 0;">Checks for active Twitch and Hitbox streams of the Mega Man Battle Network and Mega Man Star Force games.</p>
		<p>All API requests are made from your browser. The overview to the right automatically updates as long as you keep this tab open. <strong style="color: #EEE;">Therefore, avoid opening Live Now in more than one tab, and avoid refreshing constantly.</strong> If you do, it will result in more traffic going towards the APIs, meaning you may get throttled.</p>
		<p>If your browser supports desktop notifications, you can get notified whenever a stream goes live. Also, if you pin this tab, it will start flashing when someone goes live or offline.</p>
		<p>Source and license can be found on <a href="https://github.com/Prof9/livenow">GitHub</a>. This instance of Live Now uses <a href="https://github.com/tommoor/tinycon">Tinycon by Tom Moor</a>.</p>
	</div>
	<div class="tab beta" style="display: none;" style="color: #AAA">Try the beta? <a href="beta/" style="color: #AAA;">Click here.</a></div>
	<div class="tab beta" style="display: block;">This is the beta. <a href="https://github.com/Prof9/livenow/issues/new" target="_blank" style="color: #AAA;">Find any errors?</a></div>
	<div class="tab fade" style="position: fixed; right: 10pt; bottom: 0; line-height: 24px;">
		Style:
		<select id="theme">
			<option value="">Default</option>
			<option value="" disabled>------------</option>
			<option value="retrofit" selected>Retrofit</option>
			<option value="trezian">TREZian</option>
			<option value="megabuster">MegaBuster</option>
			<option value="classic">Classic</option>
		</select>
		<div id="boktai" title="Boktai streams"></div>
	</div>
	<div style="max-width: 1200px; overflow-x: auto;">
		<div id="livenow-container"></div>
		<script type="text/javascript">
			$(function() {
				var passwords = [
					{
						keys: [ 84, 65, 73, 89, 79, 72 ],
						name: 'boktai'
					}, {
						keys: [ 84, 65, 73, 89, 79, 85 ],
						name: 'boktai'
					}
				];
				for (var i = 0; i < passwords.length; i++) {
					passwords[i].progress = 0;
				}
				
				function getCookies() {
					var cookies = {};
					document.cookie.split(/;\s*/).forEach(function(e) {
						var c = e.split('=');
						if (c[0].slice(0, 8) === 'livenow_') {
							cookies[c[0].substr(('livenow_').length)] = c[1];
						}
					});
					return cookies;
				}
				
				function setCookie(key, value, expires, path) {
					if (expires === undefined) {
						expires = 'Fri, 31 Dec 9999 23:59:59 GMT';
					} else {
						expires = expires.toUTCString();
					}
					if (path === undefined) {
						path = '/';
					}
					var cookie = 'livenow_' + key + '=' + value;
					cookie += '; expires=' + expires;
					cookie += '; path=' + path;
					document.cookie = cookie;
				}
				
				function deleteCookie(key) {
					setCookie(key, '', new Date(0));
				}
				
				$('.fade').hover(function() {
					$(this).fadeTo('fast', '1');
				}, function() {
					$(this).fadeTo('fast', '0.3');
				});
				
				var defaultTheme = $('select#theme').val();
				$('select#theme option:first').text('Default (' + $('select#theme option:selected').text() + ')');
				$('select#theme').change(function() {
					var theme = $(this).val();
					if (!theme) {
						LiveNow.setTheme('thm/' + defaultTheme + '.css');
						deleteCookie('theme');
						$('select#theme')[0].selectedIndex = 0;
					} else if (typeof theme !== 'null') {
						LiveNow.setTheme('thm/' + theme + '.css');
						setCookie('theme', theme);
					}
				});
				
				function toggleBoktai() {
					var cookies = getCookies();
					console.log(cookies.boktai);
					if (cookies.boktai == 'true') {
						cookies.boktai = 'true';
						setCookie('boktai', 'false');
						alert("Boktai streams disabled!\nThe Sun will rise tomorrow...");
						location.reload();
					} else {
						cookies.boktai = 'true';
						setCookie('boktai', 'true');
						alert("Boktai streams enabled!\nTAIYOOOOHHHH!!");
						location.reload();
					}
				}
				$('#boktai').click(toggleBoktai);
				
				var cookies = getCookies();
				if (cookies.theme) {
					LiveNow.setTheme('thm/' + cookies.theme + '.css');
					setCookie('theme', cookies.theme);
					$('select#theme').val(cookies.theme);
				} else {
					LiveNow.setTheme('thm/' + defaultTheme + '.css');
					$('select#theme')[0].selectedIndex = 0;
				}
			
				document.addEventListener('keydown', function(event) {
					for (var i = 0; i < passwords.length; i++) {
						var pw = passwords[i];
						
						if (event.keyCode !== pw.keys[pw.progress++]) {
							pw.progress = 0;
						}
						if (pw.progress >= pw.keys.length) {
							pw.progress = 0;
							switch (pw.name) {
								case 'boktai':
									toggleBoktai();
									break;
							}
						}
					}
					console.log(event.keyCode);
				});
				
				// Initialize games.
				LiveNow.initGames([
					{ name: "Mega Man Battle Network",						boxart: 'box/bn1.png' },
					{ name: "Rockman EXE Operate Shooting Star",			boxart: 'box/exeoss.png' },
					{ name: "Mega Man Battle Network 2",					boxart: 'box/bn2.png' },
					{ name: "Mega Man Battle Network 3",					boxart: 'box/bn3.png' },
					{ name: "Mega Man Battle Network 4",					boxart: 'box/bn4.png' },
					{ name: "Rockman EXE 4.5 Real Operation",				boxart: 'box/exe45.png' },
					{ name: "Mega Man Battle Network 5",					boxart: 'box/bn5.png' },
					{ name: "Mega Man Battle Network 5: Double Team DS",	boxart: 'box/bn5ds.png' },
					{ name: "Mega Man Battle Network 6",					boxart: 'box/bn6.png' },
					{ name: "Mega Man Battle Chip Challenge",				boxart: 'box/bcc.png' },
					{ name: "Mega Man Network Transmission",				boxart: 'box/nt.png' },
					{ name: "Rockman EXE WS",								boxart: 'box/exews.png' },
					{ name: "Mega Man Star Force",							boxart: 'box/sf1.png' },
					{ name: "Mega Man Star Force 2",						boxart: 'box/sf2.png' },
					{ name: "Mega Man Star Force 3",						boxart: 'box/sf3.png' },
					{ name: "Mega Man Battle Network Chrono X",				boxart: 'box/bncx.png' },
					{ name: "Boktai: The Sun is in Your Hand",				boxart: 'box/bok1.png' },
					{ name: "Boktai 2: Solar Boy Django",					boxart: 'box/bok2.png' },
					{ name: "Shin Bokura no Taiyō: Gyakushū no Sabata",		boxart: 'box/bok3.png' },
					{ name: "Lunar Knights",								boxart: 'box/bokds.png' }
				]);
				
				// Initialize Twitch queue.
				LiveNow.initQueue("Twitch", [
					{ id: 0 },
					{ id: 1 },
					{ id: 2 },
					{ id: 3 },
					{ id: 4 },
					{ id: 5 },
					{ id: 6 },
					{ id: 7 },
					{ id: 8 },
					{ id: 9 },
					{ id: 10 },
					{ id: 11 },
					{ id: 12 },
					{ id: 13 },
					{ id: 14 },
					{ id: 15 }
				]);

				// Initialize Hitbox queue.
				LiveNow.initQueue("Hitbox", [
					{ id: 0,	key: 7705 },
					{ id: 1,	key: 21710 },
					{ id: 2,	key: 5312 },
					{ id: 3,	key: 11480 },
					{ id: 4,	key: 4021 },
					{ id: 5,	key: 10393 },
					{ id: 6,	key: 10999 },
					{ id: 7,	key: 8916 },
					{ id: 8,	key: 7535 },
					{ id: 9,	key: 15975 },
					{ id: 12,	key: 2567 },
					{ id: 13,	key: 16953 },
					{ id: 14,	key: 17652 },
				]);
				
				// Initialize Boktai queues.
				if (cookies.boktai == 'true') {
					$('#boktai').css({ backgroundPositionX: '0px', visibility: 'visible' });
				
					LiveNow.initQueue("Twitch", [
						{ id: 16 },
						{ id: 17 },
						{ id: 18, key: "Shin Bokura no Taiyou Gyakushuu no Sabata" },
						{ id: 19 },
					]);
					
					LiveNow.initQueue("Hitbox", [
						{ id: 16, key: 6876 },
						{ id: 17, key: 12502 },
						{ id: 18, key: 10350 },
						{ id: 19, key: 6818 },
					]);
				}
			});
		</script>
	</div>
	<div style="clear: both;"></div>
</div>
</body>
</html>